const product = [
    {
        id: 0,
        image: 'image/gg-1.jpg',
        title: 'Tea',
        price: 13,
    },
    {
        id: 1,
        image: 'image/hh-2.png',
        title: 'Pear',
        price: 4,
    },
    {
        id: 2,
        image: 'image/ee-3.jpg',
        title: 'Paste',
        price: 12,
    },
    {
        id: 3,
        image: 'image/aa-1.jpg',
        title: 'Patato',
        price: 4,
    }
    ,
    {
        id: 4,
        image: 'image/un.jpg',
        title: 'Flour',
        price: 24,
    }
    ,
    {
        id: 5,
        image: 'image/ballar.png',
        title: 'Honey',
        price: 43,
    }
    ,
    {
        id: 6,
        image: 'image/yaz.png',
        title: 'Pineapple',
        price: 15,
    }
    ,
    {
        id: 7,
        image: 'image/polen.jpeg',
        title: 'Bee Pollen',
        price: 40,
    }
    ,
    {
        id: 8,
        image: 'image/propolis.png',
        title: 'Propolis',
        price: 43,
    }
    ,
    {
        id: 9,
        image: 'image/sar_msak.jpg',
        title: 'Garlic',
        price: 7,
    }
    ,
    {
        id: 10,
        image: 'image/soğan.jpeg',
        title: 'Onion',
        price: 1,
    }
    ,
    {
        id: 11,
        image: 'image/elma.jpeg',
        title: 'Apple',
        price: 2,
    }
    ,
    {
        id: 12,
        image: 'image/ayvvva.jpeg',
        title: 'Quince',
        price: 3,
    }
    ,
    {
        id: 13,
        image: 'image/havuc.jpeg',
        title: 'Carrot',
        price: 4,
    }
    ,
    {
        id: 14,
        image: 'image/muz.jpeg',
        title: 'Banana',
        price: 22,
    }
    ,
    {
        id: 15,
        image: 'image/domates.jpeg',
        title: 'Tomato',
        price: 8,
    }
    ,
    {
        id: 16,
        image: 'image/ceviz.jpeg',
        title: 'Walnut',
        price: 47,
    }
    ,
    {
        id: 17,
        image: 'image/erik.jpeg',
        title: 'Plum',
        price: 49,
    }
    ,
    {
        id: 18,
        image: 'image/flower.jpeg',
        title: 'Flower',
        price: 100,
    }
    ,
    {
        id: 19,
        image: 'image/noodle.jpeg',
        title: 'Noodle',
        price: 2,
    }
    ,
    {
        id: 20,
        image: 'image/recel.jpeg',
        title: 'Jam',
        price: 11,
    }
    ,
    {
        id: 21,
        image: 'image/uzum.jpeg',
        title: 'Grape',
        price: 22,
    }
    ,
    {
        id: 22,
        image: 'image/greyfurt.jpg',
        title: 'Grapefruit',
        price: 26,
    }
    ,
    {
        id: 23,
        image: 'image/kivi.jpeg',
        title: 'Kiwi',
        price: 4,
    }
    ,
    {
        id: 24,
        image: 'image/kazma.jpeg',
        title: 'Pickaxe',
        price: 45,
    }
    ,
    {
        id: 25,
        image: 'image/kurek.jpg',
        title: 'Spade',
        price: 46,
    }
    ,
    {
        id: 26,
        image: 'image/makarna.jpg',
        title: 'Pasta',
        price: 4,
    }
    ,
    {
        id: 27,
        image: 'image/ilac.jpg',
        title: 'Medicine',
        price: 10,
    }
    ,
    {
        id: 28,
        image: 'image/hormon.jpg',
        title: 'Hormone',
        price: 98,
    }
    ,
    {
        id: 29,
        image: 'image/gubre.jpeg',
        title: 'Fertilizer',
        price: 88,
    }
    ,
    {
        id: 30,
        image: 'image/bulgur.jpeg',
        title: 'Bulgur',
        price: 3,
    }
    ,
    {
        id: 31,
        image: 'image/rice.jpeg',
        title: 'Rice',
        price: 40,
    }
    ,
    {
        id: 32,
        image: 'image/mısır.jpeg',
        title: 'Sweetcorn',
        price: 4,
    }
    ,
    {
        id: 33,
        image: 'image/purslane.jpeg',
        title: 'Purslane',
        price: 1,
    }
    ,
    {
        id: 34,
        image: 'image/orange.jpeg',
        title: 'Orange',
        price: 2,
    }
    ,
    {
        id: 35,
        image: 'image/seftali.jpeg',
        title: 'Peach',
        price: 5,
    }
    ,
    {
        id: 36,
        image: 'image/kayısı.jpeg',
        title: 'Apricot',
        price: 6,
    }
    ,
    {
        id: 37,
        image: 'image/badem.jpg',
        title: 'Almond',
        price: 17,
    }
    ,
    {
        id: 38,
        image: 'image/hindistan.jpeg',
        title: 'Coconut',
        price: 44,
    }
    ,
    {
        id: 39,
        image: 'image/tohum.jpg',
        title: 'Seed',
        price: 47,
    }
    ,
    {
        id: 40,
        image: 'image/cekirdek.jpeg',
        title: 'Sunflower Seed',
        price: 40,
    }
    ,
    {
        id: 41,
        image: 'image/yag.jpeg',
        title: 'Oil',
        price: 77,
    }
    ,
    {
        id: 42,
        image: 'image/sut.jpeg',
        title: 'Milk',
        price: 10,
    }
    ,
    {
        id: 43,
        image: 'image/zeytin.jpeg',
        title: 'Oliver',
        price: 15,
    }
    ,
    {
        id: 44,
        image: 'image/cilek.jpeg',
        title: 'Strawberry',
        price: 40,
    }
    ,
    {
        id: 45,
        image: 'image/dut.jpeg',
        title: 'Mulberry',
        price: 43,
    }
    ,
    {
        id: 46,
        image: 'image/ahududu.jpg',
        title: 'Raspberry',
        price: 44,
    }
    ,
    {
        id: 47,
        image: 'image/yabanmersini.jpeg',
        title: 'Blueberry',
        price: 45,
    }
    ,
    {
        id: 48,
        image: 'image/seker.jpeg',
        title: 'Sugar',
        price: 42,
    }
    ,
    {
        id: 49,
        image: 'image/tuz.jpeg',
        title: 'Salt',
        price: 1,
    }
    ,
    {
        id: 50,
        image: 'image/tatlandirici.jpg',
        title: 'Sweetener',
        price: 42,
    },
    {
        id: 51,
        image: 'image/surup.jpeg',
        title: 'Syroup',
        price: 56,
    }

];

document.getElementById('root').innerHTML = product.map(item => {
    const { id, image, title, price } = item;
    return (
        `<div class='box'>
            <div class='img-box'>
                <img class='images' src='${image}'></img>
            </div>
            <div class='bottom'>
                <p>${title}</p>
                <h2>$ ${price}.00</h2>
                <button onclick='addToCart(${id})'>Add to cart</button>
                
            </div>
        </div>`
    );
}).join('');

var cart = [];

function addToCart(productId) {
    var selectedProduct = product.find(item => item.id === productId);
    if (selectedProduct) {
        cart.push({ ...selectedProduct });
        displayCart();
    }
}

function displayCart() {
    let total = 0;
    document.getElementById("count").innerHTML = cart.length;
    if (cart.length == 0) {
        document.getElementById('cartItem').innerHTML = "Your cart is empty";
        document.getElementById("total").innerHTML = "$ " + 0 + ".00";
    } else {
        document.getElementById("cartItem").innerHTML = cart.map((item, index) => {
            const { id, image, title, price } = item;
            total += price;
            document.getElementById("total").innerHTML = "$ " + total.toFixed(2);
            return (
                `<div class='cart-item'>
                    <div class='row-img'>
                        <img class='rowimg' src='${image}'>
                    </div>
                    <p style='font-size:12px;'>${title}</p>
                    <h2 style='font-size: 15px;'>$ ${price}.00</h2>
                    <button onclick='removeFromCart(${index})'><i class="fa-solid fa-trash" style="font-size: 14px;"></i>

                </div>`
            );
        }).join('');
    }
}
function removeFromCart(index) {
    cart.splice(index, 1);
    displayCart();
}





document.getElementById('buy-now').addEventListener('click', function() {
    console.log('Buy Now clicked');
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "addtocart.php", true);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            alert("Order placed successfully");

            console.log(xhr.responseText);
            var response = JSON.parse(xhr.responseText);
            var totalPrice = response.totalPrice;
            var productNames = response.productNames;


            document.getElementById("total").innerHTML = "$ " + totalPrice.toFixed(2);
            document.getElementById("cartItem").innerHTML = productNames.join(', ');
        }
    };

    var total = cart.reduce((acc, item) => acc + parseFloat(item.price), 0);

    var products = cart.map(item => ({ product_name: item.title, price: item.price }));

    xhr.send(JSON.stringify(products)); 
});
